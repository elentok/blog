<html><head><meta charSet="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0, minimum-scale=1.0, maximum-scale=1.0"/><link rel="preload" as="image" href="http://3.bp.blogspot.com/-42K_XxQ5_tc/TkT6dJxiN7I/AAAAAAAABLs/NvFKWGbf7Ow/s400/task_editor.png"/><title>Autocomplete textbox for multiple keywords/tags entry in PySide | David Elentok&#x27;s Blog</title><meta property="og:title" content="Autocomplete textbox for multiple keywords/tags entry in PySide"/><meta property="og:description"/><meta property="og:type" content="article"/><meta property="og:image"/><meta property="og:url" content="https://blog.elentok.com/2011/08/autocomplete-textbox-for-multiple.html"/><meta property="og:site_name" content="David Elentok&#x27;s Blog"/><meta name="twitter:card" content="summary"/><meta name="twitter:site" content="@elentok"/><meta name="twitter:title" content="Autocomplete textbox for multiple keywords/tags entry in PySide"/><meta name="twitter:image" content="https://blog.elentok.com/avatar-og.png"/><meta name="twitter:description"/><style type="text/css">
      body {
        font-family: sans-serif;
        background: #242424;
        color: #e9e9e9;
        font-size: 18px;
        line-height: 1.5;
      }

      a, a:visited {
        color: #98adec;
      }

      a:hover {
        color: #c5d2f9;
      }

      .e-container {
        margin: auto;
        max-width: 700px;
        padding: 15px;
      }
      </style><style type="text/css">
          @import "/style.css";
          @import url('https://fonts.googleapis.com/css?family=Open+Sans:400,700|Open+Sans+Condensed:300|Source+Code+Pro');
          </style></head><body><div class="e-container"><a class="e-header" href="/"><div class="e-header__avatar"><div class="e-avatar"></div></div><h2>David Elentok&#x27;s Blog</h2></a><div class="e-about-me"><a href="http://elentok.com">About me</a></div><div class="e-post e-post--full"><h1 class="e-post__title">Autocomplete textbox for multiple keywords/tags entry in PySide</h1><div class="e-post__date">August 12, 2011</div><div class="e-post__tags"><a class="e-post-tag" href="/tags/pyside.html">pyside</a><a class="e-post-tag" href="/tags/qtodotxt.html">qtodotxt</a><a class="e-post-tag" href="/tags/programming.html">programming</a><a class="e-post-tag" href="/tags/qt.html">qt</a><a class="e-post-tag" href="/tags/python.html">python</a><a class="e-post-tag" href="/tags/projects.html">projects</a></div><div class="e-post__body"><p>Last month I started writing <a href="/2011/06/qtodotxt-cross-platform-todotxt-gui.html">QTodoTxt</a>, a PySide (Python Qt bindings) GUI for the
<a href="http://todotxt.com/">todo.txt</a> concept.</p>
<p>While using it for my own todo list I noticed several features that were missing (I intend to
implement them all in due time), one of these features was auto-completion for projects and contexts
when editing or creating a new task, something like this:</p>
<center>
<p><a href="http://3.bp.blogspot.com/-42K_XxQ5_tc/TkT6dJxiN7I/AAAAAAAABLs/NvFKWGbf7Ow/s1600/task_editor.png"><img src="http://3.bp.blogspot.com/-42K_XxQ5_tc/TkT6dJxiN7I/AAAAAAAABLs/NvFKWGbf7Ow/s400/task_editor.png" alt=""/></a></p>
</center>
<p>After some googling I found the built-in QCompleter component that can be easily attached to any
QLineEdit control and allow easy auto-completion:</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span>lineEdit </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> QtGui</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>QLineEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>completer </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> QtGui</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>QCompleter</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27;one&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27;two&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27;three&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27;four&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>lineEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>setCompleter</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>lineEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<p>However, this only allows auto-completing for the first word and I wanted to auto-completion for
every word in the text. So I went back to google and found <a href="http://developer.qt.nokia.com/forums/viewthread/5376">a post</a> in the Qt developers forum
that shows a simple implementation of this in C++.</p>
<p>Instead of using the QLineEdit&#x27;s <code>setCompleter</code> method (which wasn&#x27;t available for QTextEdit he was
using), his implementation handles opening the completer manually and just attaches the completer to
the QLineEdit using the <code>QCompleter.setWidget</code> method.</p>
<p>To create my own auto-complete control I implemented his C++ control in python and added some extra
features of my own. At first I created the AutoCompleteEdit class that inherits from QLineEdit and
initializes the QCompleter:</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">from</span><span> PySide </span><span class="token" style="color:hsl(286, 60%, 67%)">import</span><span> QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> QtGui
</span>
<span></span><span class="token" style="color:hsl(286, 60%, 67%)">class</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">AutoCompleteEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>QtGui</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>QLineEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>  </span><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">__init__</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> model</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> separator </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27; &#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> \
</span><span>      addSpaceAfterCompleting </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">True</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">super</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>AutoCompleteEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>__init__</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_separator </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> separator
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_addSpaceAfterCompleting </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> \
</span>        addSpaceAfterCompleting
<span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> QtGui</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>QCompleter</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>model</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>setWidget</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>connect</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>SIGNAL</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(95, 38%, 62%)">&#x27;activated(QString)&#x27;</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>        self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_insertCompletion</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_keysToIgnore </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> </span><span class="token" style="color:hsl(220, 14%, 71%)">[</span><span>QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Qt</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Key_Enter</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                          QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Qt</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Key_Return</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                          QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Qt</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Key_Escape</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span>
</span><span>                          QtCore</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Qt</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>Key_Tab</span><span class="token" style="color:hsl(220, 14%, 71%)">]</span><span class="token" style="color:hsl(207, 82%, 66%)">&lt;</span><span class="token" style="color:hsl(207, 82%, 66%)">/</span><span>pre</span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span></code></div></pre>
<p>I overrode the keyPressEvent method of QLineEdit to handle the completion manually:</p>
<pre><div style="background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:1em;margin:0.5em 0;overflow:auto;border-radius:0.3em"><code class="language-python" style="white-space:pre;background:hsl(220, 13%, 18%);color:hsl(220, 14%, 71%);text-shadow:0 1px rgba(0, 0, 0, 0.3);font-family:&quot;Fira Code&quot;, &quot;Fira Mono&quot;, Menlo, Consolas, &quot;DejaVu Sans Mono&quot;, monospace;direction:ltr;text-align:left;word-spacing:normal;word-break:normal;line-height:1.5;-moz-tab-size:2;-o-tab-size:2;tab-size:2;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none"><span class="token" style="color:hsl(286, 60%, 67%)">def</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">keyPressEvent</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>self</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> event</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>popup</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>isVisible</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> event</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>key</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">in</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_keysToIgnore</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>        event</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>ignore</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>        </span><span class="token" style="color:hsl(286, 60%, 67%)">return</span><span>
</span><span>    </span><span class="token" style="color:hsl(95, 38%, 62%)">super</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>AutoCompleteEdit</span><span class="token" style="color:hsl(220, 14%, 71%)">,</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>keyPressEvent</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>event</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    completionPrefix </span><span class="token" style="color:hsl(207, 82%, 66%)">=</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>textUnderCursor</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> completionPrefix </span><span class="token" style="color:hsl(207, 82%, 66%)">!=</span><span> self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>completionPrefix</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_updateCompleterPopupItems</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>completionPrefix</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">len</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>event</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>text</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span> </span><span class="token" style="color:hsl(286, 60%, 67%)">and</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">len</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>completionPrefix</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">&gt;</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>complete</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span>
</span><span>    </span><span class="token" style="color:hsl(286, 60%, 67%)">if</span><span> </span><span class="token" style="color:hsl(95, 38%, 62%)">len</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span>completionPrefix</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span> </span><span class="token" style="color:hsl(207, 82%, 66%)">==</span><span> </span><span class="token" style="color:hsl(29, 54%, 61%)">0</span><span class="token" style="color:hsl(220, 14%, 71%)">:</span><span>
</span><span>      self</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>_completer</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>popup</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span><span class="token" style="color:hsl(220, 14%, 71%)">.</span><span>hide</span><span class="token" style="color:hsl(220, 14%, 71%)">(</span><span class="token" style="color:hsl(220, 14%, 71%)">)</span></code></div></pre>
<p>This method performs the following tasks:</p>
<ul>
<li>If the user pressed Enter, Escape or Tab the method ignores them and returns.</li>
<li>Every other character is forwarded to the base method.</li>
<li>Filters the items displayed in the completer popup to only show the items that start with the text
the user started to write (the completion prefix).</li>
</ul>
<p>Thank you for reading,</p>
<p>You can see the full code in my <a href="https://bitbucket.org/3david/qtodotxt/src/ec1e74eef575/qtodotxt/ui/controls/autocomplete_lineedit.py">Bitbucket repository</a></p>
<p>Please feel free to leave comments,</p>
<p>David.</p></div></div><div class="e-post__next"><span>Next:</span><a class="e-post__next" href="/2011/08/review-miui-234a-on-htc-desire.html">Review: MIUI 2.3.4a on HTC Desire</a></div></div></body></html>